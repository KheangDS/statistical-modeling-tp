---
title: "TP 1"
format: html
editor: visual
---

---
title: "Statistical Models Exercise Answers"
subtitle: "Institute of Technology of Cambodia — I4STM"
author: "Student Name"
format: html
editor: visual
---

# SECTION 1: DATA VISUALIZATION

## Task 1: Galton Heredity

```{r}
 # Install and load dataset install.packages("HistData") library(HistData) data(Galton) Galton <- data.frame(Galton)
```

### a. Contingency table between children and parents’ height

```{r}
table_Galton <- table(round(Galton$parent, 1), round(Galton$child, 1))
table_Galton
```

### (b) Scatter plot with regression line

```{r}
plot(Galton$parent, Galton$child,
main = "Scatter plot of Children Height vs Parents Average Height",
xlab = "Average Height of Parents (inch)",
ylab = "Height of Children (inch)",
pch = 19, col = "skyblue")
abline(lm(child ~ parent, data = Galton), col = "red", lwd = 2)
```

## Task 2: Munich Rent Index (1999)

```{r}
install.packages("gamlss.data")
library(gamlss.data)
library(dplyr)
data(rent99)
rent99 <- data.frame(rent99)
```

### (a) Histograms and Kernel Density Plots

```{r}
par(mfrow=c(2,2))
hist(rent99$rent, prob=TRUE, main="Net Rent", xlab="Net rent (€)", col="lightblue")
lines(density(rent99$rent), col="red", lwd=2)

hist(rent99$rentsqm, prob=TRUE, main="Net Rent per sqm", xlab="€", col="lightgreen")
lines(density(rent99$rentsqm), col="red", lwd=2)

hist(rent99$area, prob=TRUE, main="Area (sqm)", xlab="sqm", col="lightyellow")
lines(density(rent99$area), col="red", lwd=2)

hist(rent99$yearc, prob=TRUE, main="Year of Construction", xlab="Year", col="lightgray")
lines(density(rent99$yearc), col="red", lwd=2)

```

### (b) Scatter Plots

```{r}
par(mfrow=c(2,2))
plot(rent99$area, rent99$rent, main="Net Rent vs Area", xlab="Area (sqm)", ylab="Net Rent (€)", pch=19, col="blue")
plot(rent99$area, rent99$rentsqm, main="Rent per sqm vs Area", xlab="Area (sqm)", ylab="Rent/sqm (€)", pch=19, col="darkgreen")
plot(rent99$yearc, rent99$rent, main="Net Rent vs Year", xlab="Year", ylab="Net Rent (€)", pch=19, col="purple")
plot(rent99$yearc, rent99$rentsqm, main="Rent per sqm vs Year", xlab="Year", ylab="Rent/sqm (€)", pch=19, col="orange")
```

### (c) Average and SD Plot

```{r}
rent_summary <- rent99 %>%
group_by(area) %>%
summarise(avg_rent = mean(rent), sd_rent = sd(rent),
avg_rentsqm = mean(rentsqm), sd_rentsqm = sd(rentsqm))

plot(rent_summary$area, rent_summary$avg_rent, type="l",
main="Average Net Rent vs Area", xlab="Area", ylab="Average Rent")
lines(rent_summary$area, rent_summary$avg_rent + rent_summary$sd_rent, lty=2)
lines(rent_summary$area, rent_summary$avg_rent - rent_summary$sd_rent, lty=2)
```

### (d) Boxplot and Density by Location

```{r}
boxplot(rentsqm ~ location, data=rent99,
main="Net Rent per sqm by Location",
xlab="Location", ylab="Rent per sqm (€)", col=c("skyblue","lightgreen","lightpink"))

plot(density(rent99$rentsqm), main="Kernel Density: Net Rent per sqm", col="red", lwd=2)
```

## Task 3: Fuel Consumption

```{r}
install.packages("alr4")
library(alr4)
data(fuel2001)
fuel2001 <- data.frame(fuel2001)
```

### (a) Create new variables

```{r}
fuel2001$Fuel <- 1000 * fuel2001$FuelC / fuel2001$Pop
fuel2001$Dlic <- 1000 * fuel2001$Drivers / fuel2001$Pop
fuel2001$logMiles <- log(fuel2001$Miles)
```

### (b) Summary and Correlation Plot

```{r}
summary(fuel2001)
pairs(fuel2001[, c("Fuel", "Dlic", "Income", "logMiles", "Tax")], main="Correlation Plot")
```

# SECTION 2: nassCDS DATA ANALYSIS

```{r}
install.packages("DAAG")
library(DAAG)
data(nassCDS)
```

## Question 1: Seatbelt Use and Mortality

### (1)

```{r}
sum(nassCDS$seatbelt == "belted", na.rm=TRUE)
```

### (2)

```{r}
table_seat <- table(nassCDS$seatbelt, nassCDS$dead)
table_seat
```

### (3) Proportion test

```{r}
test_proportion <- function(tab){
  p1 <- tab[1,2]/sum(tab[1,])
  p2 <- tab[2,2]/sum(tab[2,])
  p <- (tab[1,2]+tab[2,2])/sum(tab)
  se <- sqrt(p*(1-p)*(1/sum(tab[1,])+1/sum(tab[2,])))
  z <- (p1 - p2)/se
  pval <- 2*pnorm(-abs(z))
  return(data.frame(Z_statistic=z, P_value=pval))
}
test_proportion(table_seat)
```

### (4) Visualization

```{r}
barplot(table_seat, beside=TRUE, col=c("skyblue","salmon"),
main="Seatbelt Usage vs Accident Outcome", ylab="Count")
```

## Question 2: Age of Occupants and Accident Outcome

```{r}
tapply(nassCDS$ageOFocc, nassCDS$dead, mean, na.rm=TRUE)
tapply(nassCDS$ageOFocc, nassCDS$dead, sd, na.rm=TRUE)

boxplot(ageOFocc ~ dead, data=nassCDS, main="Occupant Age by Outcome",
xlab="Outcome", ylab="Age", col=c("orange","lightblue"))
stripchart(ageOFocc ~ dead, data=nassCDS, vertical=TRUE, add=TRUE, pch=16, col="blue")

alive <- nassCDS$ageOFocc[nassCDS$dead=="alive"]
dead  <- nassCDS$ageOFocc[nassCDS$dead=="dead"]
t.test(alive, dead, var.equal=FALSE)
```

## Question 3: Sex, Age, and Safety Devices

### (1)

```{r}
boxplot(ageOFocc ~ sex, data=nassCDS, main="Occupant Age by Sex", col=c("pink","lightblue"))
```

### (2)

```{r}
sum(nassCDS$ageOFocc > 50 & nassCDS$dead=="alive", na.rm=TRUE)
```

### (3)

```{r}
nassCDS$AgeOFocc_class <- ifelse(nassCDS$ageOFocc > 50, 1, 0)
```

### (4-7)

```{r}
nassCDS_o50 <- nassCDS %>%
filter(ageOFocc > 50) %>%
select(dead, airbag, weight, injSeverity) %>%
na.omit()

dim(nassCDS_o50)

barplot(table(nassCDS_o50$dead, nassCDS_o50$airbag),
beside=TRUE, col=c("skyblue","tomato"),
main="Airbag vs Outcome (Age > 50)", ylab="Count")

barplot(table(nassCDS_o50$injSeverity, nassCDS_o50$airbag),
beside=TRUE, col=c("lightgreen","pink"),
main="Airbag vs Injury Severity (Age > 50)", ylab="Count")
```

## Question 4: Summary Function for Fatal Accidents

```{r}
nass_analysis <- function(data){
  d <- subset(data, dead=="dead")
  pct_dead <- 100 * nrow(d) / nrow(data)
  pct_male <- 100 * sum(d$sex=="male", na.rm=TRUE)/nrow(d)
  pct_female <- 100 * sum(d$sex=="female", na.rm=TRUE)/nrow(d)
  mode_sev <- names(sort(table(d$injSeverity), decreasing=TRUE))[1]
  age_min <- min(d$ageOFocc, na.rm=TRUE)
  age_max <- max(d$ageOFocc, na.rm=TRUE)
  table_out <- data.frame(pct_dead, pct_male, pct_female, mode_sev, age_min, age_max)
  hist(d$injSeverity, main="Injury Severity among Deaths", xlab="Injury Severity", col="lightblue")
  return(table_out)
}
nass_analysis(nassCDS)
```

## Question 5: Seatbelt Users Summary

```{r}
seatbelt_users <- nassCDS[nassCDS$seatbelt=="belted", ]
nrow(seatbelt_users)
table(seatbelt_users$dead)
table(seatbelt_users$dead, seatbelt_users$occRole)

seatbelt_users <- seatbelt_users[order(seatbelt_users$injSeverity, seatbelt_users$ageOFocc), ]
head(seatbelt_users[order(-seatbelt_users$weight), ], 25)
```

## Question 6: Age, Seatbelt, and Airbag Relationship

```{r}
par(mfrow=c(1,2))
with(nassCDS, {
boxplot(ageOFocc ~ injSeverity + seatbelt,
main="Age by Injury Severity (Seatbelt)", col=c("skyblue","lightgreen"))
boxplot(ageOFocc ~ injSeverity + airbag,
main="Age by Injury Severity (Airbag)", col=c("pink","lightyellow"))
})

```
